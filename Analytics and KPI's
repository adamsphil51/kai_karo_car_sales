-- Kai & Karo Car Sales
-- Analytics / KPI Queries

-- 1. Total revenue across all sales
SELECT SUM(total_amount) AS total_revenue
FROM sales;

-- 2. Revenue per branch
SELECT b.branch_name, SUM(s.total_amount) AS branch_revenue
FROM sales s
JOIN branches b ON s.branch_id = b.branch_id
GROUP BY b.branch_name
ORDER BY branch_revenue DESC;

-- 3. Revenue per car brand and model
SELECT c.brand, c.model, SUM(s.total_amount) AS revenue
FROM sales s
JOIN cars c ON s.car_id = c.car_id
GROUP BY c.brand, c.model
ORDER BY revenue DESC;

-- 4. Monthly revenue trend
SELECT DATE_TRUNC('month', sale_date) AS month, SUM(total_amount) AS monthly_revenue
FROM sales
GROUP BY month
ORDER BY month;

-- 5. Top-selling cars by units sold
SELECT c.brand, c.model, SUM(s.quantity) AS units_sold
FROM sales s
JOIN cars c ON s.car_id = c.car_id
GROUP BY c.brand, c.model
ORDER BY units_sold DESC
LIMIT 10;

-- 6. Salesman performance ranking
SELECT sm.first_name, sm.last_name, SUM(s.total_amount) AS total_sales
FROM sales s
JOIN salesmen sm ON s.salesman_id = sm.salesman_id
GROUP BY sm.first_name, sm.last_name
ORDER BY total_sales DESC;

-- 7. Cars low in stock (less than 5 units)
SELECT brand, model, stock
FROM cars
WHERE stock < 5
ORDER BY stock ASC;

-- 8. Average sale value per branch
SELECT b.branch_name, AVG(s.total_amount) AS avg_sale_value
FROM sales s
JOIN branches b ON s.branch_id = b.branch_id
GROUP BY b.branch_name
ORDER BY avg_sale_value DESC;

-- 9. Revenue by year of manufacture
SELECT c.year_of_manufacture, SUM(s.total_amount) AS revenue
FROM sales s
JOIN cars c ON s.car_id = c.car_id
GROUP BY c.year_of_manufacture
ORDER BY c.year_of_manufacture DESC;

-- 10. Top 5 customers by lifetime purchase
SELECT cu.first_name, cu.last_name, SUM(s.total_amount) AS lifetime_value
FROM sales s
JOIN customers cu ON s.customer_id = cu.customer_id
GROUP BY cu.first_name, cu.last_name
ORDER BY lifetime_value DESC
LIMIT 5;
